from datetime import date

class Pagina:
    def __init__(self, numero: int, contenido: str):
        self.numero = numero
        self.contenido = contenido

    def mostrarInfo(self):
        return f"Pagina {self.numero}: {self.contenido}"

class Libro:
    def __init__(self, titulo: str, isbn: str, paginas_contenido: list):
        self.titulo = titulo
        self.isbn = isbn
        self.paginas = [Pagina(i+1, texto) for i, texto in enumerate(paginas_contenido)]

    def leer(self):
        print(f"Leyendo libro: {self.titulo} (ISBN: {self.isbn})")
        for p in self.paginas:
            print(p.mostrarInfo())

    def mostrarInfo(self):
        return f"Libro: {self.titulo} | ISBN: {self.isbn} | Paginas: {len(self.paginas)}"

class Autor:
    def __init__(self, nombre: str, nacionalidad: str):
        self.nombre = nombre
        self.nacionalidad = nacionalidad

    def mostrarInfo(self):
        return f"Autor: {self.nombre} ({self.nacionalidad})"

class Estudiante:
    def __init__(self, codigo: str, nombre: str):
        self.codigo = codigo
        self.nombre = nombre

    def mostrarInfo(self):
        return f"Estudiante: {self.codigo} - {self.nombre}"

class Prestamo:
    def __init__(self, estudiante: Estudiante, libro: Libro, fecha_prestamo: date = None):
        self.estudiante = estudiante
        self.libro = libro
        self.fecha_prestamo = fecha_prestamo or date.today()
        self.fecha_devolucion = None

    def devolver(self, fecha: date = None):
        self.fecha_devolucion = fecha or date.today()

    def mostrarInfo(self):
        fe1 = self.fecha_prestamo.isoformat() if self.fecha_prestamo else 'N/A'
        fe2 = self.fecha_devolucion.isoformat() if self.fecha_devolucion else '---'
        return (f"Prestamo: {self.libro.titulo} a {self.estudiante.nombre} | "
                f"Prestado: {fe1} | Devuelto: {fe2}")

class Horario:
    def __init__(self, dias_apertura: str, hora_apertura: str, hora_cierre: str):
        self.dias_apertura = dias_apertura
        self.hora_apertura = hora_apertura
        self.hora_cierre = hora_cierre

    def mostrarHorario(self):
        return f"Dias: {self.dias_apertura} | {self.hora_apertura} - {self.hora_cierre}"

class Biblioteca:
    def __init__(self, nombre: str, horario: Horario):
        self.nombre = nombre
        self.libros = []
        self.autores = []
        self.prestamos = []
        self.horario = horario

    def agregarLibro(self, libro: Libro):
        self.libros.append(libro)
        print(f"[Agregacion] Libro agregado: {libro.titulo}")

    def agregarAutor(self, autor: Autor):
        self.autores.append(autor)
        print(f"[Agregacion] Autor registrado: {autor.nombre}")

    def prestarLibro(self, estudiante: Estudiante, libro: Libro):
        if libro not in self.libros:
            print(f"El libro '{libro.titulo}' no esta disponible en la biblioteca.")
            return None
        prestamo = Prestamo(estudiante, libro)
        self.prestamos.append(prestamo)
        print(f"[Prestamo] {libro.titulo} prestado a {estudiante.nombre}")
        return prestamo

    def mostrarEstado(self):
        print(f"\n=== Biblioteca: {self.nombre} ===")
        print(f"Horario: {self.horario.mostrarHorario()}")
        print('\nAutores registrados:')
        if self.autores:
            for a in self.autores:
                print(' -', a.mostrarInfo())
        else:
            print(' (ninguno)')

        print('\nLibros disponibles:')
        if self.libros:
            for l in self.libros:
                print(' -', l.mostrarInfo())
        else:
            print(' (ninguno)')

        print('\nPrestamos activos:')
        if self.prestamos:
            for p in self.prestamos:
                print(' -', p.mostrarInfo())
        else:
            print(' (ninguno)')
        print('=== Fin estado ===\n')

    def cerrarBiblioteca(self):
        print(f"La biblioteca '{self.nombre}' se ha cerrado. Los prestamos activos se eliminan.")
        self.prestamos.clear()

if __name__ == '__main__':
    autor1 = Autor('Gabriela Mistral', 'Chile')
    autor2 = Autor('Jorge Luis Borges', 'Argentina')

    contenido_libro1 = [
        'Introduccion al misterio',
        'Capitulo 1: El origen',
        'Capitulo 2: La busqueda'
    ]
    libro1 = Libro('Misterios y cuentos', 'ISBN-0001', contenido_libro1)

    contenido_libro2 = [
        'Prologo',
        'Ensayo sobre la identidad',
        'Epilogo'
    ]
    libro2 = Libro('Ensayos escogidos', 'ISBN-0002', contenido_libro2)

    horario_biblio = Horario('Lun-Vie', '08:00', '18:00')

    biblioteca = Biblioteca('Biblioteca UMSA', horario_biblio)

    biblioteca.agregarAutor(autor1)
    biblioteca.agregarAutor(autor2)

    biblioteca.agregarLibro(libro1)
    biblioteca.agregarLibro(libro2)

    biblioteca.mostrarEstado()

    est1 = Estudiante('2025001', 'Maria Perez')
    est2 = Estudiante('2025002', 'Luis Quispe')

    p1 = biblioteca.prestarLibro(est1, libro1)
    p2 = biblioteca.prestarLibro(est2, libro2)

    biblioteca.mostrarEstado()

    libro1.leer()

    p1.devolver()
    print('\n[Accion] Devolver prestamo 1')
    biblioteca.mostrarEstado()

    biblioteca.cerrarBiblioteca()
